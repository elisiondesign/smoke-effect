{"version":3,"sources":["smoke.js"],"names":["Smoke","context","color","window","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","time","running","dt","lastframe","updateAndDrawParticles","polyfillAnimFrame","call","frame","addParticles","smokeParticleImage","makeSmokeSprite","performance","now","start","end","Math","random","smokeSprite","document","createElement","ctx","getContext","data","createImageData","smokeSpriteSize","d","i","length","opacities","width","height","putImageData","x","y","options","particle","vx","floatInRange","minVx","maxVx","startvy","minVy","maxVy","scale","minScale","maxScale","lifetime","minLifetime","maxLifetime","age","finalScale","vy","deltatime","frac","sqrt","globalAlpha","abs","off","xmin","xmax","ymin","ymax","drawImage","numParticles","particles","push","createParticle","clearRect","canvas","forEach","p","updateParticle","filter","preDrawCallback","drawParticle","callback"],"mappings":";AA8HK,aAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,KAAA,EAAA,OAAA,eAAA,EAAA,EAAA,CAAA,MAAA,EAAA,YAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,GAAA,EAAA,EAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA9HgBA,IAAAA,EA8HhB,WA/GWC,SAAAA,EAAAA,EAASC,GAAO,IAAA,EAAA,KAAA,EAAA,KAAA,GAbhB,EAAA,KAAA,YAAA,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,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","file":"smoke.map","sourceRoot":"../src","sourcesContent":["export default class Smoke {\n\n    opacities = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 5, 5, 7, 4, 4, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 17, 27, 41, 52, 56, 34, 23, 15, 11, 4, 9, 5, 1, 0, 0, 0, 0, 0, 0, 1, 45, 63, 57, 45, 78, 66, 52, 41, 34, 37, 23, 20, 0, 1, 0, 0, 0, 0, 1, 43, 62, 66, 64, 67, 115, 112, 114, 56, 58, 47, 33, 18, 12, 10, 0, 0, 0, 0, 39, 50, 63, 76, 87, 107, 105, 112, 128, 104, 69, 64, 29, 18, 21, 15, 0, 0, 0, 7, 42, 52, 85, 91, 103, 126, 153, 128, 124, 82, 57, 52, 52, 24, 1, 0, 0, 0, 2, 17, 41, 67, 84, 100, 122, 136, 159, 127, 78, 69, 60, 50, 47, 25, 7, 1, 0, 0, 0, 34, 33, 66, 82, 113, 138, 149, 168, 175, 82, 142, 133, 70, 62, 41, 25, 6, 0, 0, 0, 18, 39, 55, 113, 111, 137, 141, 139, 141, 128, 102, 130, 90, 96, 65, 37, 0, 0, 0, 2, 15, 27, 71, 104, 129, 129, 158, 140, 154, 146, 150, 131, 92, 100, 67, 26, 3, 0, 0, 0, 0, 46, 73, 104, 124, 145, 135, 122, 107, 120, 122, 101, 98, 96, 35, 38, 7, 2, 0, 0, 0, 50, 58, 91, 124, 127, 139, 118, 121, 177, 156, 88, 90, 88, 28, 43, 3, 0, 0, 0, 0, 30, 62, 68, 91, 83, 117, 89, 139, 139, 99, 105, 77, 32, 1, 1, 0, 0, 0, 0, 0, 16, 21, 8, 45, 101, 125, 118, 87, 110, 86, 64, 39, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 28, 79, 79, 117, 122, 88, 84, 54, 46, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 6, 55, 61, 68, 71, 30, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 23, 25, 20, 12, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 12, 9, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0];\n    smokeSpriteSize = 20;\n    particles = [];\n    running = false;\n    smokeParticleImage = null;\n    lastframe = null;\n    preDrawCallback = () => { };\n    context = null;\n  \n    polyfillAnimFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||\n      window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;\n  \n  \n    constructor(context, color) {\n      this.context = context;\n      this.smokeParticleImage = this.makeSmokeSprite(color);\n      this.lastframe = performance.now()\n    }\n  \n    frame = (time) => {\n      if (!this.running) return;\n      var dt = time - this.lastframe;\n      this.lastframe = time;\n      this.updateAndDrawParticles(dt);\n      this.polyfillAnimFrame.call(window, this.frame);\n    }\n  \n    floatInRange(start, end) {\n      return start + Math.random() * (end - start)\n    }\n  \n    makeSmokeSprite(color = [24, 46.8, 48.2]) {\n      var smokeSprite = document.createElement('canvas'),\n        ctx = smokeSprite.getContext('2d'),\n        data = ctx.createImageData(this.smokeSpriteSize, this.smokeSpriteSize),\n        d = data.data\n  \n      for (var i = 0; i < d.length; i += 4) {\n        d[i] = color[0]\n        d[i + 1] = color[1]\n        d[i + 2] = color[2]\n        d[i + 3] = this.opacities[i / 4]\n      }\n  \n      smokeSprite.width = this.smokeSpriteSize\n      smokeSprite.height = this.smokeSpriteSize\n  \n      ctx.putImageData(data, 0, 0)\n  \n      return smokeSprite\n    }\n  \n    createParticle(x, y, options) {\n      options = options || {}\n      var particle = {\n        x: x,\n        y: y,\n        vx: this.floatInRange(options.minVx || -8 / 100, options.maxVx || 8 / 100),\n        startvy: this.floatInRange(options.minVy || -4 / 10, options.maxVy || 1 / 10),\n        scale: this.floatInRange(options.minScale || 0, options.maxScale || 0.5),\n        lifetime: this.floatInRange(options.minLifetime || 2000, options.maxLifetime || 8000),\n        age: 0,\n      }\n      particle.finalScale = this.floatInRange(\n        options.minScale || 25 + particle.scale,\n        options.maxScale || 30 + particle.scale\n      )\n      particle.vy = particle.startvy\n      return particle\n    }\n  \n    updateParticle(particle, deltatime) {\n      particle.x += particle.vx * deltatime\n      particle.y += particle.vy * deltatime\n      var frac = Math.sqrt(particle.age / particle.lifetime)\n      particle.vy = (1 - frac) * particle.startvy\n      particle.age += deltatime\n      particle.scale = frac * particle.finalScale\n    }\n  \n    drawParticle(particle, smokeParticleImage) {\n      this.context.globalAlpha = (1 - Math.abs(1 - 2 * particle.age / particle.lifetime)) / 8\n      var off = particle.scale * this.smokeSpriteSize / 2\n      var xmin = particle.x - off\n      var xmax = xmin + off * 3\n      var ymin = particle.y - off\n      var ymax = ymin + off * 2\n      this.context.drawImage(smokeParticleImage, xmin, ymin, xmax - xmin, ymax - ymin)\n    }\n  \n    addParticles(x, y, numParticles, options) {\n      numParticles = numParticles || 10;\n      if (numParticles < 1) return Math.random() <= numParticles && this.particles.push(this.createParticle(x, y, options));\n      for (var i = 0; i < numParticles; i++) this.particles.push(this.createParticle(x, y, options))\n    }\n  \n    updateAndDrawParticles(deltatime) {\n      this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n  \n      this.particles.forEach((p) => { this.updateParticle(p, deltatime) })\n      this.particles = this.particles.filter(function (p) { return p.age < p.lifetime })\n  \n      this.preDrawCallback(deltatime, this.particles)\n      this.particles.forEach((p) => { this.drawParticle(p, this.smokeParticleImage, this.context) })\n    }\n  \n    setPreDrawCallback(callback) {\n      this.preDrawCallback = callback;\n    }\n  \n    step(dt) {\n      dt = dt || 16;\n      this.updateAndDrawParticles(dt);\n    }\n  \n    start() {\n      this.running = true;\n      this.lastframe = performance.now();\n      this.polyfillAnimFrame.call(window, this.frame);\n      // this.step();\n    }\n  \n    stop() {\n      this.running = false;\n    }\n  \n    addSmoke = this.addParticles;\n  }\n  "]}